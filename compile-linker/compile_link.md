# 1.编译过程
```shell
gcc hello.c
./a.out
```
编译过程可以分解为4个步骤：预处理、编译、汇编、链接

## 1.1 预编译
源代码文件hello.c和相关的头文件，如stdio.h等被预编译器cpp预编译成一个`.i`文件。
预编译过程相当于下面的命令：
```
gcc -E hello.c -o hello.i
```
或者：
```
cpp hello.c > hello.i
```
预编译主要处理源代码文件中以“#”开始的预编译指令。如#include、#define等

## 1.2 编译
编译过程就是把预处理完的文件进行一系列的词法分析、语法分析、语义分析及优化后产生相应的汇编代码文件。
编译相当于下面的指令：
```
gcc -S hello.i -o hello.s
```
也可直接调用ccl来完成
```
/usr/lib/gcc/i486-linux-gun/4.1/ccl hello.c
```
或者使用：
```
gcc -S hello.c -o hello.s
```

## 1.3 汇编
汇编器是将汇编代码转变成机器可以执行的指令。
汇编过程可以通过汇编器as来完成：
```
as hello.s -o hello.o
```
或者：
```
gcc -c hello.s -o hello.o
```
或者使用gcc命令从C源码文件开始，经过预编译、编译和汇编直接输入目标文件
这条命令式较为常用的方式
```
gcc -c hello.c -o hello.o
```

## 链接
后续分析

# 2.细探编译器
编译器是将高级语言翻译成机器语言的一个工具。
编译过程一般分成6步：扫描、语法分析、语义分析、源代码优化、代码生成和目标代码优化

## 2.1 词法分析
源代码被输入到扫描器，并运行一种类似于有限状态机的算法将源码的字符串分割成一系列的记号（Token） 。
词法分析的记号一般可以分成：关键字、标识符、字面量（数字，字符串等）、特殊符号（加号，等号）

## 2.2 语法分析
语法分析器将由扫描器产生的记号进行语法分析，从而产生语法树。

## 2.3 语义分析
语法分析仅是完成了对表达式的语法层面的分析，但是并不了解这个语句是否真正有意义。比如两个指针做乘法运算。**编译器能分析的语义是静态语义**，即是在编译期可以确定的语义。
静态语义包含声明和类型的匹配，类型的转换。动态语义一般指在运行期出现的语义相关的问题，如除0操作。
经过语义分析阶段后，整个语法树的表达式都被标识了类型。

## 2.4 中间语言生成
现代的编译器有很多层次的优化，往往在源码级别会有一个优化过程。
由于直接在语法树上作优化比较困难，故源代码优化器往往将整个语法树换成**中间代码**，它是语法树的顺序表示。
中间代码有多种类型，比较常见的有：三地址码和P-代码。
以三地址码为例：
x = y op z
这个三地址码表示将变量y和z进行op操作后，赋值给x。
中间代码使得编译器被分为前端和后端。编译器前端负责产生机器无关的中间代码，编译器后端将中间代码转换成目标机器代码。

## 2.5 目标代码生成与优化
从产生中间代码后的所有过程都属于编译器的后端。
编译器后端主要包括**代码生成器**和**目标代码优化器**。
代码生成器：
代码生成器将中间代码转换成目标机器代码，这个过程十分依赖目标机器。
目标代码优化器：
对目标代码进行优化，例如选择合适的寻址方式、使用位移来代替乘法运算、删除多余的指令等。

如果目标代码中有全局变量或函数定义在其他模块，那么全局变量和函数的绝对地址都要在连接的时候才能确定。
现代编译器可以将一个源代码文件编译成一个未链接的目标文件，然后由链接器最终将这些目标文件链接起来形成可执行文件。

# 3.链接器
